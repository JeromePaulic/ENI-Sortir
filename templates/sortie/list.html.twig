{% extends 'base.html.twig' %}

{% block title %} {% endblock %}

{% block header %}
    {% if is_granted('ROLE_USER') %}
        <div>
            <h6> Date du jour: {{  "now"|date('d/m/Y') }}</h6>
            <h6> Participant: {{ app.user.prenom }} {{ app.user.nom }}</h6>
        </div>
    {%  endif %}
{% endblock %}

{% block body %}

    <h2>Les Sorties</h2>




<div class="container ml-0 mr-0 pl-0 pr-0">
    {{ form_start(rechercheForm, {'attr': {'class': 'row'}}) }}
    <div class="col col-sm-3 d-flex flex-column justify-content-end">
        {{ form_row(rechercheForm.campus_nom, {attr: {class: 'form-control-sm'}}) }}
        {{ form_row(rechercheForm.rechercher, {attr: {class: 'form-control-sm'}}) }}
    </div>
    <div class="col col-sm-3 d-flex flex-column justify-content-end">
        {{ form_row(rechercheForm.date_min, {attr: {class: 'form-control-sm'}}) }}
        {{ form_row(rechercheForm.date_max, {attr: {class: 'form-control-sm'}}) }}
    </div>
    <div class="col col-sm-4 d-flex flex-column justify-content-start event-filters-checkboxes">

      {{ form_row(rechercheForm.je_suis_organisateur) }}
       {{ form_row(rechercheForm.sortie_inscrit) }}
        {{ form_row(rechercheForm.sortie_non_inscrit) }}
        {{ form_row(rechercheForm.sortie_passee) }}
    </div>
    <div class="col col-sm d-flex flex-column justify-content-end">
        {{ form_row(rechercheForm.submit) }}
    </div>
    {{ form_end(rechercheForm) }}
</div>

{% if rechercheSorties %}
<table class="table table-striped table-sm event-table">
    <tr>
        <th>Intitulé</th>
        <th>Statut</th>
        <th class="d-none d-lg-table-cell">Inscrits</th>
        <th class="d-none d-md-table-cell">Places restantes</th>
        <th class="d-none d-md-table-cell">Date de début</th>
        <th class="d-none d-lg-table-cell">Organisé par</th>
        <th>Action</th>
    </tr>
    {% for sortie in rechercheSorties %}
    <tr>
        <td><a href="{{ path('sortie_details', {'id': sortie.id}) }}">{{ sortie.nom }}</a></td>
        <td>{{ sortie.etat.libelle }}</td>
        <td class="d-none d-lg-table-cell">{{ sortie.inscriptions|length }}</td>
        {% if sortie.nbParticipantMax %}
            <td class="d-none d-md-table-cell">{{ sortie.nbParticipantMax - sortie.inscriptions|length }} / {{sortie.nbParticipantMax }}</td>
        {% else %}
            <td class="d-none d-md-table-cell">&#8734;</td>
        {% endif %}
        <td class="d-none d-md-table-cell">{{ sortie.dateHeureDebut|date("d-m-Y à H:i") }}</td>

        <td class="d-none d-lg-table-cell">

                <a href="{{ path('profil', {id:sortie.organisateur.id}) }}" title="Voir son profil">{{ sortie.organisateur.prenom ~ " " ~ sortie.organisateur.nom|first }} ({{sortie.organisateur.campus.nom }})</a>
        </td>

        <td>
            {% if sortie.etat.libelle == 'ouverte' %}

            {% elseif sortie.etat.libelle == 'créée' and sortie.organisateur == app.user %}
                <a href="{{ path('sortie_publish', {'id': sortie.id}) }}">Publier</a>
                <a href="#">Modifier</a>
            {% endif %}
            {% if sortie.organisateur == app.user %}
                <a href="{{ path('sortie_supprimer', {'id': sortie.id}) }}">Annuler</a>
                {% else %}
                    <a href="{{ path('inscription_inscriptionoupas', {'id': sortie.id}) }}"> Me désinscrire / M'inscrire </a>
            {% endif %}
        </td>
    </tr>
    {% endfor %}
</table>


{% else %}
    <div>Aucune sortie !</div>
{% endif %}
<br>
  <button>  <a href="{{ path('sortie_cree') }}"title="crer-sortie">Créer une sortie</a></button>
    <br>

{% endblock %}


{#  {% block body %}
<section>
    {% for sortie in sorties %}
    <article>
        <div>
          Nom de la sortie:  {{ sortie.nom }}
        </div>
        <div>
          Date et Heure de début:  {{ sortie.dateHeureDebut | date ("d-m-Y à H:i")}}
        </div>
        <div>
         Date limite de d'inscription   {{ sortie.dateLimiteInscription|date ('d-m-Y') }}
        </div>
        <div>
           Nombre de place: {{ sortie.inscriptions|length }} /  {{ sortie.nbParticipantMax }}
        </div>
        <div>
          Etat:  {{ sortie.etat.libelle }}
        </div>
        <div>
          Organisateur:  {{ sortie.organisateur.nom }}
        </div>
        <a href="{{ path('sortie_details' ,{'id': sortie.id}) }}" title="detail de la sortie">Afficher</a>

        <a href="{{ path('inscription_inscriptionoupas',{'id':sortie.id}) }}" title="inscription">S'inscrire</a>
        <a href="{{ path('inscription_inscriptionoupas',{'id':sortie.id}) }}" title="deinscription">Se déinscritre</a>
    </article>
<br>


    {% endfor %}
</section>
{% endblock %}
#}